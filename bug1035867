# HG changeset patch
# Parent 19f4fdf07edcc6ace71351d76e8a609cd1014bee
# User Antonio M. Amaya <amac@tid.es>
Bug 1035867 - Fix WebappRT for the new Webapps implementation

diff --git a/mobile/android/chrome/content/WebappRT.js b/mobile/android/chrome/content/WebappRT.js
--- a/mobile/android/chrome/content/WebappRT.js
+++ b/mobile/android/chrome/content/WebappRT.js
@@ -73,40 +73,38 @@ let WebappRT = {
         this._enableRemoteDebugger(aUrl);
       }
     });
 
     this.findManifestUrlFor(aUrl, aCallback);
   },
 
   getManifestFor: function (aUrl, aCallback) {
-    DOMApplicationRegistry.registryReady.then(() => {
-      let request = navigator.mozApps.mgmt.getAll();
-      request.onsuccess = function() {
-        let apps = request.result;
-        for (let i = 0; i < apps.length; i++) {
-          let app = apps[i];
-          let manifest = new ManifestHelper(app.manifest, app.origin);
+    let request = navigator.mozApps.mgmt.getAll();
+    request.onsuccess = function() {
+      let apps = request.result;
+      for (let i = 0; i < apps.length; i++) {
+        let app = apps[i];
+        let manifest = new ManifestHelper(app.manifest, app.origin);
 
-          // if this is a path to the manifest, or the launch path, then we have a hit.
-          if (app.manifestURL == aUrl || manifest.fullLaunchPath() == aUrl) {
-            aCallback(manifest, app);
-            return;
-          }
+        // if this is a path to the manifest, or the launch path, then we have a hit.
+        if (app.manifestURL == aUrl || manifest.fullLaunchPath() == aUrl) {
+          aCallback(manifest, app);
+          return;
         }
+      }
 
-        // Otherwise, once we loop through all of them, we have a miss.
-        aCallback(undefined);
-      };
+      // Otherwise, once we loop through all of them, we have a miss.
+      aCallback(undefined);
+    };
 
-      request.onerror = function() {
-        // Treat an error like a miss. We can't find the manifest.
-        aCallback(undefined);
-      };
-    });
+    request.onerror = function() {
+      // Treat an error like a miss. We can't find the manifest.
+      aCallback(undefined);
+    };
   },
 
   findManifestUrlFor: function(aUrl, aCallback) {
     this.getManifestFor(aUrl, function(aManifest, aApp) {
       if (!aManifest) {
         // we can't find the manifest, so open it like a web page
         aCallback(aUrl);
         return;
